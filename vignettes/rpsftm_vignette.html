<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Simon Bond, Annabel Allison" />

<meta name="date" content="2018-08-14" />

<title>rpsftm: rank-preserving structural failure time models for survival data</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">rpsftm: rank-preserving structural failure time models for survival data</h1>
<h4 class="author"><em>Simon Bond, Annabel Allison</em></h4>
<h4 class="date"><em>2018-08-14</em></h4>



<div id="summary" class="section level2">
<h2>Summary</h2>
<p>The package <code>rpsftm</code> provides functions to fit a rank preserving structural failure time model to a two-arm clinical trial with survival outcomes.</p>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The rank preserving structural failure time model (RPSFTM) is a method used to adjust for treatment switching in trials with survival outcomes. Treatment switching occurs when patients switch from their randomised arm to the other treatment during the study. The RPSFTM is due to <em>Robins and Tsiatis (1991)</em> and has been developed by <em>White et al. (1997, 1999)</em>.</p>
<p>The method is randomisation based and uses only the randomised treatment group, observed event times and treatment history in order to estimate a causal treatment effect. The treatment effect, <span class="math inline">\(\psi\)</span>, is estimated by balancing counter-factual event times (i.e. the time that would be observed if no treatment were received) between treatment groups. A g-estimation procedure is used to find the value of <span class="math inline">\(\psi\)</span> such that a test statistic <span class="math inline">\(Z(\psi) = 0\)</span>. Recensoring must be performed as censoring becomes informative on the counter-factual time scale.</p>
</div>
<div id="syntax" class="section level2">
<h2>Syntax</h2>
<p><code>rpsftm(formula, data, censor_time, subset, na.action, test=survdiff, low_psi=-1, hi_psi=1, alpha=0.05, treat_modifier=1, autoswitch=TRUE, n_eval_z=100, ...)</code></p>
<p><br> <code>rpsftm</code> is the main function used for estimating causal parameters under the RPSFTM. The arguments are as follows:</p>
<ul>
<li><p><code>formula</code> a formula with a minimal structure of <code>Surv(time, status) ~ rand(arm, rx)</code> where</p>
<ul>
<li><code>arm</code> is the randomised treatment arm, and</li>
<li><code>rx</code> is the proportion of time spent on treatment, taking values in [0, 1].</li>
</ul>
Further terms can be added to the right hand side to adjust for covariates.</li>
<li><code>data</code> an optional data frame containing the variables.</li>
<li><code>censor_time</code> the time at which censoring would, or has occurred. This is provided for all observations unlike standard Kaplan-Meier or Cox regression where it is only given for censored observations. If no value is given then recensoring is not applied.</li>
<li><code>subset</code> an expression indicating which subset of the rows of data should be used in the fit. This can be a logical vector, a numeric vector indicating which observation numbers are to be included, or a character vector of row names to be included. All observations are included by default.</li>
<li><code>na.action</code> a missing-data filter function. This is applied to the <code>model.frame</code> after any subset argument has been used. Default is <code>options()$na.action</code>.</li>
<li><code>test</code> one of <code>survdiff</code>, <code>coxph</code> or <code>survreg</code>. Describes the test to be used in the estimating equation. Default is <code>survdiff</code>.</li>
<li><code>low_psi</code> the lower limit of the range to search for the causal parameter. Default is -1.</li>
<li><code>hi_psi</code> the upper limit of the range to search for the causal parameter. Default is 1.</li>
<li><code>alpha</code> the significance level used to calculate the confidence intervals. Default is 0.05.</li>
<li><code>treat_modifier</code> an optional parameter that <span class="math inline">\(\psi\)</span> is multiplied by on an individual observation level to give differing impact to treatment. Default is 1.</li>
<li><code>autoswitch</code> a logical to autodetect cases of no switching. Default is TRUE. If all observations in an arm have perfect compliance then recensoring is not applied in that arm. If FALSE then recensoring is applied regardless of perfect compliance.</li>
<li><p><code>n_eval_z</code> The number of points between <code>hi_psi</code> and <code>low_psi</code> at which to evaluate the Z-statistics in the estimating equation. Default is 100.</p></li>
</ul>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>The <code>rpsftm</code> function will be illustrated using a simulated dataset <code>immdef</code> based on a randomized controlled trial; see <em>Concorde Coordinating Committee (1994)</em>. The trial compares two policies (immediate or deferred treatment) of zidovudine treatment in symptom free individuals infected with HIV. The immediate treatment arm received treatment at randomisation whilst the deferred arm received treatment either at onset of AIDS related complex or AIDs or development of persistently low CD4 count. The primary endpoint was time to progression to AIDS or CDC group IV disease, or death.</p>
<div id="data" class="section level3">
<h3>Data</h3>
<p>The <code>immdef</code> data frame has 1000 observations and 8 variables:</p>
<ul>
<li><strong>id</strong> participant ID number</li>
<li><strong>def</strong> indicator that the participant was assigned to the Deferred treatment arm</li>
<li><strong>imm</strong> indicator that the participant was assigned to the Immediate treatment arm</li>
<li><strong>censyrs</strong> censoring time, corresponding to the close of study minus the time of randomisation for each participant</li>
<li><strong>xo</strong> an indicator that crossover occurred</li>
<li><strong>xoyrs</strong> the time from randomisation at which crossover happened, or 0 for participants in the Immediate arm</li>
<li><strong>prog</strong> an indicator of disease progression (1), or censoring (0)</li>
<li><strong>progyrs</strong> time from randomisation of disease progression or censoring</li>
<li><strong>entry</strong> the time from the global start of study of the participant’s entry into the study</li>
</ul>
<p>The first six entries are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpsftm)
<span class="kw">head</span>(immdef)
<span class="co">#&gt;   id def imm censyrs xo    xoyrs prog  progyrs entry</span>
<span class="co">#&gt; 1  1   0   1       3  0 0.000000    0 3.000000     0</span>
<span class="co">#&gt; 2  2   1   0       3  1 2.652797    0 3.000000     0</span>
<span class="co">#&gt; 3  3   0   1       3  0 0.000000    1 1.737838     0</span>
<span class="co">#&gt; 4  4   0   1       3  0 0.000000    1 2.166291     0</span>
<span class="co">#&gt; 5  5   1   0       3  1 2.122100    1 2.884646     0</span>
<span class="co">#&gt; 6  6   1   0       3  1 0.557392    0 3.000000     0</span></code></pre></div>
<p>For example, subject 2 was randomised to the deferred arm, started treatment at 2.65 years and was censored at 3 years (the end of the study). Subject 3 was randomised to the immediate treatment arm and progressed (observed the event) at 1.74 years. Subject 5 was randomised to the deferred treatment arm, started treatment at 2.12 years and progressed at 2.88 years. The trial lasted 3 years with staggered entry over the first 1.5 years. The variable <strong>censyrs</strong> gives the time from entry to the end of the trial. The table below shows summary statistics for the <code>immdef</code> data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>( <span class="kw">requireNamespace</span>(<span class="st">&quot;tableone&quot;</span>)){
  vars       &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;def&quot;</span>, <span class="st">&quot;imm&quot;</span>, <span class="st">&quot;censyrs&quot;</span>, <span class="st">&quot;xo&quot;</span>, <span class="st">&quot;xoyrs&quot;</span>, <span class="st">&quot;prog&quot;</span>, <span class="st">&quot;progyrs&quot;</span>, <span class="st">&quot;entry&quot;</span>)
  factorVars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;def&quot;</span>, <span class="st">&quot;imm&quot;</span>, <span class="st">&quot;xo&quot;</span>, <span class="st">&quot;prog&quot;</span>) 
  tableone<span class="op">::</span><span class="kw">CreateTableOne</span>(<span class="dt">vars=</span>vars, <span class="dt">data=</span>immdef, <span class="dt">factorVars=</span>factorVars, <span class="dt">includeNA=</span><span class="ot">FALSE</span>, <span class="dt">test=</span><span class="ot">FALSE</span>)
} <span class="cf">else</span>{
  <span class="kw">summary</span>(immdef)
}
<span class="co">#&gt; Loading required namespace: tableone</span>
<span class="co">#&gt;                      </span>
<span class="co">#&gt;                       Overall     </span>
<span class="co">#&gt;   n                   1000        </span>
<span class="co">#&gt;   def = 1 (%)          500 (50.0) </span>
<span class="co">#&gt;   imm = 1 (%)          500 (50.0) </span>
<span class="co">#&gt;   censyrs (mean (sd)) 2.25 (0.45) </span>
<span class="co">#&gt;   xo = 1 (%)           189 (18.9) </span>
<span class="co">#&gt;   xoyrs (mean (sd))   0.78 (0.93) </span>
<span class="co">#&gt;   prog = 1 (%)         312 (31.2) </span>
<span class="co">#&gt;   progyrs (mean (sd)) 1.93 (0.66) </span>
<span class="co">#&gt;   entry (mean (sd))   0.75 (0.45)</span></code></pre></div>
</div>
</div>
<div id="fitting-the-rpsftm" class="section level2">
<h2>Fitting the RPSFTM</h2>
<p>We now show how to use <code>rpsftm</code> with the <code>immdef</code> data. First, a variable <strong>rx</strong> for the proportion of time spent on treatment must be created:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rx &lt;-<span class="st"> </span><span class="kw">with</span>(immdef, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>xoyrs<span class="op">/</span>progyrs)</code></pre></div>
<p>This sets <strong>rx</strong> to 1 in the immediate treatment arm (since no patients could switch to the deferred arm), 0 in the deferred arm patients that did not receive treatment and <strong>1 - xoyrs/progyrs</strong> in the deferred arm patients that did receive treatment. Using the default options, the fitted model is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rpsftm_fit_lr &lt;-<span class="st"> </span><span class="kw">rpsftm</span>(<span class="dt">formula=</span><span class="kw">Surv</span>(progyrs, prog) <span class="op">~</span><span class="st"> </span><span class="kw">rand</span>(imm, rx), 
                        <span class="dt">data=</span>immdef, 
                        <span class="dt">censor_time=</span>censyrs)</code></pre></div>
<p>The above formula fits a RPSFTM where <code>progyrs</code> is the observed event time, <code>prog</code> is the indicator of disease progression, <code>imm</code> is the randomised treatment group indicator, <code>rx</code> is the proportion of time spent on treatment and <code>censyrs</code> is the censoring time. The log rank test is used in finding the point estimate of <span class="math inline">\(\psi\)</span>, <span class="math inline">\(\hat{\psi}\)</span>. Recensoring is performed since the <code>censor_time</code> parameter is specified; if not specified then recensoring would not be performed. After finding <span class="math inline">\(\hat{\psi}\)</span>, <code>rpsftm</code> refits the model at <span class="math inline">\(\hat{\psi}\)</span> and produces a <code>survdiff</code> object of the counter-factual event times to be used in plotting Kaplan-Meier curves. The function returns</p>
<ul>
<li><strong>psi</strong> the estimated parameter</li>
<li><strong>fit</strong> a <code>survdiff</code> object to produce Kaplan-Meier curves of the estimated counter-factual event times in each treatment arm using <code>plot()</code></li>
<li><strong>CI</strong> a vector of the confidence interval around <strong>psi</strong></li>
<li><strong>Sstar</strong> the (possibly) recensored <code>Surv()</code> data using <strong>psi</strong></li>
<li><strong>rand</strong> the <code>rand()</code> object used to specify the allocated and observed amount of treatment</li>
<li><strong>ans</strong> the values from <code>uniroot.all</code> used to solve the estimating equation, but embeded within a list as per <code>uniroot</code>, with an extra element <code>root_all</code>, a vector of all roots found in the case of multiple solutions. The first element of <code>root_all</code> is subsequently used.</li>
<li><strong>eval_z</strong> a data frame giving values of the Z-statistics at different values of <strong>psi</strong></li>
<li>Further elements corresponding to either a <code>survdiff</code>, <code>coxph</code>, or <code>survreg</code> object. This will always include:
<ul>
<li><strong>call</strong> the R call object</li>
<li><strong>formula</strong> a formula representing any adjustments, strata or clusters used</li>
<li><strong>terms</strong>_ a more detailed representation of the model formula</li>
</ul></li>
</ul>
<p>The point estimate and 95% confidence interval can be returned using <code>rpsftm_fit_lr$psi</code> and <code>rpsftm_fit_lr$CI</code> which gives <span class="math inline">\(\hat{\psi} = -0.181 (-0.35, 0.00204)\)</span>. The function <code>plot()</code> produces Kaplan-Meier curves of the counter-factual event times in each group and can be used to check that the distributions are indeed the same at <span class="math inline">\(\hat{\psi}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="co">#&gt; Warning: package 'ggplot2' was built under R version 3.5.1</span>
<span class="kw">plot</span>(rpsftm_fit_lr)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<!-- COXPH-->
<p>We now provide examples of using the Cox regression model and the Weibull model in place of the log rank test. To use the Wald test from a Cox regression model, we specify <code>test=coxph</code> in the function parameters. Covariates can also be included in the estimation procedure by adding them to the right hand side of the formula. For example, baseline covariates that are included in the intention-to-treat analysis may also be incorporated into the estimation procedure of the RPSFTM. In the following example we add entry time as a covariate and use <code>summary()</code> to find the value of <span class="math inline">\(\hat{\psi}\)</span> and its 95% confidence interval:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rpsftm_fit_cph &lt;-<span class="st"> </span><span class="kw">rpsftm</span>(<span class="dt">formula=</span><span class="kw">Surv</span>(progyrs, prog) <span class="op">~</span><span class="st"> </span><span class="kw">rand</span>(imm, rx) <span class="op">+</span><span class="st"> </span>entry, 
                         <span class="dt">data=</span>immdef, 
                         <span class="dt">censor_time=</span>censyrs,
                         <span class="dt">test=</span>coxph)
<span class="kw">summary</span>(rpsftm_fit_cph)
<span class="co">#&gt;   arm   rx.Min. rx.1st Qu. rx.Median   rx.Mean rx.3rd Qu.   rx.Max.</span>
<span class="co">#&gt; 1   0 0.0000000  0.0000000 0.0000000 0.1574062  0.2547779 0.9770941</span>
<span class="co">#&gt; 2   1 1.0000000  1.0000000 1.0000000 1.0000000  1.0000000 1.0000000</span>
<span class="co">#&gt;   n= 1000, number of events= 286 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         coef exp(coef) se(coef)     z Pr(&gt;|z|)</span>
<span class="co">#&gt; entry 0.1235    1.1315   0.1487 0.831    0.406</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       exp(coef) exp(-coef) lower .95 upper .95</span>
<span class="co">#&gt; entry     1.131     0.8838    0.8454     1.514</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Concordance= 0.514  (se = 0.018 )</span>
<span class="co">#&gt; Rsquare= 0.001   (max possible= 0.976 )</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; psi: -0.1811697</span>
<span class="co">#&gt; exp(psi): 0.8342938</span>
<span class="co">#&gt; Confidence Interval, psi -0.3496874 0.003370267</span>
<span class="co">#&gt; Confidence Interval, exp(psi)  0.7049084 1.003376</span></code></pre></div>
<p>From the output we get <span class="math inline">\(\hat{\psi} = -0.181 (-0.35, 0.00337)\)</span>. Again, we can plot the Kaplan-Meier curves of the counter-factual event times in each group:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rpsftm_fit_cph)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<!--SURVREG-->
<p>Similary, for the Weibull model we have:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rpsftm_fit_wb &lt;-<span class="st"> </span><span class="kw">rpsftm</span>(<span class="dt">formula=</span><span class="kw">Surv</span>(progyrs, prog) <span class="op">~</span><span class="st"> </span><span class="kw">rand</span>(imm, rx) <span class="op">+</span><span class="st"> </span>entry, 
                        <span class="dt">data=</span>immdef, 
                        <span class="dt">censor_time=</span>censyrs,
                        <span class="dt">test=</span>survreg)
<span class="kw">summary</span>(rpsftm_fit_wb)
<span class="co">#&gt;   arm   rx.Min. rx.1st Qu. rx.Median   rx.Mean rx.3rd Qu.   rx.Max.</span>
<span class="co">#&gt; 1   0 0.0000000  0.0000000 0.0000000 0.1574062  0.2547779 0.9770941</span>
<span class="co">#&gt; 2   1 1.0000000  1.0000000 1.0000000 1.0000000  1.0000000 1.0000000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; rpsftm(formula = Surv(progyrs, prog) ~ rand(imm, rx) + entry, </span>
<span class="co">#&gt;     data = immdef, censor_time = censyrs, test = survreg)</span>
<span class="co">#&gt;               Value Std. Error      z        p</span>
<span class="co">#&gt; (Intercept)  1.3881     0.0857 16.197 5.34e-59</span>
<span class="co">#&gt; entry       -0.0582     0.0906 -0.642 5.21e-01</span>
<span class="co">#&gt; Log(scale)  -0.4176     0.0568 -7.349 2.00e-13</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Scale= 0.659 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Weibull distribution</span>
<span class="co">#&gt; Loglik(model)= -759.8   Loglik(intercept only)= -760</span>
<span class="co">#&gt; Number of Newton-Raphson Iterations: 6 </span>
<span class="co">#&gt; n= 1000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; psi: -0.1811851</span>
<span class="co">#&gt; exp(psi): 0.8342809</span>
<span class="co">#&gt; Confidence Interval, psi -0.3501459 0.005170935</span>
<span class="co">#&gt; Confidence Interval, exp(psi)  0.7045852 1.005184</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rpsftm_fit_wb)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The output shows that <span class="math inline">\(\hat{\psi} = -0.181 (-0.35, 0.00517)\)</span>. In all three cases, the point estimate and 95% confidence interval of <span class="math inline">\(\psi\)</span> are similar.</p>
<div id="checking-the-search-interval" class="section level3">
<h3>Checking the search interval</h3>
<p>There are two instances where <code>rpsftm</code> will produce warning messages due to the search interval. The function first evaluates <span class="math inline">\(Z(\psi)\)</span> at <span class="math inline">\(\psi =\)</span> <code>low_psi</code>, <code>hi_psi</code> and will produce a warning message if <span class="math inline">\(Z(\psi)\)</span> is the same sign at these two points.</p>
<pre><code>#&gt; Warning in rpsftm(formula = Surv(progyrs, prog) ~ rand(imm, rx), data = immdef, : 
#&gt; The starting interval (1, 2) to search for a solution for psi
#&gt; gives values of the same sign (-8.95, -12.3).
#&gt; Try a wider interval. plot(obj$eval_z, type=&quot;s&quot;), where obj is the output of rpsftm()
#&gt; Warning in rpsftm(formula = Surv(progyrs, prog) ~ rand(imm, rx), data =
#&gt; immdef, : Evaluation of the estimated values of psi failed. It is set to NA
#&gt; Warning in rpsftm(formula = Surv(progyrs, prog) ~ rand(imm, rx), data =
#&gt; immdef, : Evaluation of a limit of the Confidence Interval failed. It is
#&gt; set to NA
#&gt;   arm   rx.Min. rx.1st Qu. rx.Median   rx.Mean rx.3rd Qu.   rx.Max.
#&gt; 1   0 0.0000000  0.0000000 0.0000000 0.1574062  0.2547779 0.9770941
#&gt; 2   1 1.0000000  1.0000000 1.0000000 1.0000000  1.0000000 1.0000000
#&gt; Fitting failed. yes</code></pre>
<p>This suggests widening the search interval via trial and error until the values of <span class="math inline">\(Z(\psi)\)</span> at <code>low_psi</code> and <code>hi_psi</code> are of opposite sign. The second warning message occurs when <code>uniroot</code> , the function used to search the interval (<code>low_psi</code>, <code>hi_psi</code>) for <span class="math inline">\(\hat{\psi}\)</span> and its 95% confidence interval, fails to find any one of these. It will set the value to NA and produce the following warning message</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rpsftm_fit &lt;-<span class="st"> </span><span class="kw">rpsftm</span>(<span class="dt">formula=</span><span class="kw">Surv</span>(progyrs, prog) <span class="op">~</span><span class="st"> </span><span class="kw">rand</span>(imm, rx),
                     <span class="dt">data=</span>immdef, 
                     <span class="dt">censor_time=</span>censyrs,
                     <span class="dt">low_psi=</span><span class="op">-</span><span class="dv">1</span>, 
                     <span class="dt">hi_psi=</span><span class="op">-</span><span class="fl">0.1</span>)
<span class="co">#&gt; Warning in rpsftm(formula = Surv(progyrs, prog) ~ rand(imm, rx), data =</span>
<span class="co">#&gt; immdef, : Evaluation of a limit of the Confidence Interval failed. It is</span>
<span class="co">#&gt; set to NA</span></code></pre></div>
<p>Investigation of a plot of <span class="math inline">\(Z(\psi)\)</span> against <span class="math inline">\(\psi\)</span> (example shown below) for a range of values of <span class="math inline">\(\psi\)</span> could show why the functions fails to find a root. The fitted object, <code>rpsftm_fit</code>, returns a data frame (<code>rpsftm_fit$eval_z</code>) with values of the Z-statistic evaluated at 100 points between the limits of the search interval. It is therefore straightforward to plot <span class="math inline">\(Z(\psi)\)</span> against <span class="math inline">\(\psi\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rpsftm_fit<span class="op">$</span>eval_z, <span class="dt">type=</span><span class="st">&quot;s&quot;</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">6</span>))
<span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">qnorm</span>(<span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>)))
<span class="kw">abline</span>(<span class="dt">v=</span>rpsftm_fit<span class="op">$</span>psi)
<span class="kw">abline</span>(<span class="dt">v=</span>rpsftm_fit<span class="op">$</span>CI)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>In this case, we see that the search interval used in <code>rpsftm</code> was not wide enough to find the upper confidence limit. The plot can also be used to check for multiple roots as <code>uniroot</code> will only return one root.</p>
</div>
</div>
<div id="methods" class="section level2">
<h2>Methods</h2>
<div id="rpsftm-assumptions" class="section level3">
<h3>RPSFTM assumptions</h3>
<p>Let <span class="math inline">\(T_i = T_i^{off} + T_i^{on}\)</span> be the observed event time for subject <span class="math inline">\(i\)</span>, where <span class="math inline">\(T_i^{off}\)</span> and <span class="math inline">\(T_i^{on}\)</span> are the time that the patient spent off and on treatment, respectively. The <span class="math inline">\(T_i\)</span> are related to the counter-factual or treatment-free event times <span class="math inline">\(U_i\)</span> by the causal model <span class="math display">\[
U_i = T_i^{off} + T_i^{on}\exp(\psi_0)
\]</span> where <span class="math inline">\(\exp(-\psi_0)\)</span> is the acceleration factor associated with treatment and <span class="math inline">\(\psi_0\)</span> is the true causal parameter.</p>
<p>To estimate <span class="math inline">\(\psi\)</span> we assume that the <span class="math inline">\(U_i\)</span> are independent of randomised treatment group <span class="math inline">\(R\)</span>, i.e. if the groups are similar with respect to all other characteristics except treatment, the average event times should be the same in each group if no individual were treated. A g-estimation procedure is used to find the value of <span class="math inline">\(\psi\)</span> such that <span class="math inline">\(U\)</span> is independent of <span class="math inline">\(R\)</span>. For each value of <span class="math inline">\(\psi\)</span> considered, the hypothesis <span class="math inline">\(\psi_0 = \psi\)</span> is tested by computing <span class="math inline">\(U_i(\psi)\)</span> and calculating <span class="math inline">\(Z(\psi)\)</span> as the test statistic. This is usually the same test statistic as for the intention-to-treat analysis. In the <code>rpsftm</code> function, the test options are log rank (default), Cox, and Weibull. For the parametric Weibull test, the point estimate (<span class="math inline">\(\hat{\psi}\)</span>) is the value of <span class="math inline">\(\psi\)</span> for which <span class="math inline">\(Z(\psi) = 0\)</span>. For the non-parametric tests (log rank, Cox), <span class="math inline">\(\hat{\psi}\)</span> is the value of <span class="math inline">\(\psi\)</span> for which <span class="math inline">\(Z(\psi)\)</span> crosses 0, since <span class="math inline">\(Z(\psi)\)</span> is a step function. Confidence intervals are similarly found with the <span class="math inline">\(100(1-\alpha)\%\)</span> confidence interval being the set <span class="math inline">\(\{\psi: |Z(\psi)| &lt; z_{1-\alpha/2}\}\)</span>, where <span class="math inline">\(z_{1-\alpha/2}\)</span> is the <span class="math inline">\(1-\alpha/2\)</span> percentile of the standard normal distribution.</p>
<p>As well as assuming that the only difference between randomised groups is the treatment received, the RPSFTM also assumes a ‘common treatment effect’. The common treatment effect assumption states that the treatment effect is the same for all individuals (with respect to time spent on treatment) regardless of when treatment is received.</p>
</div>
<div id="recensoring" class="section level3">
<h3>Recensoring</h3>
<p>The censoring indicators of the observed event times are initially carried over to the counter-factual event times. However, the uninformative censoring on the <span class="math inline">\(T_i\)</span> scale may be informative on the <span class="math inline">\(U_i\)</span> scale. Suppose we have two individuals with the same <span class="math inline">\(U_i\)</span>, one of whom receives the superior treatment. The individual receiving the superior treatment has their <span class="math inline">\(U_i\)</span> extended so that they are censored whilst the other individual may observe the event. Therefore, on the <span class="math inline">\(U_i\)</span> scale, censoring is informative with respect to treatment group. To overcome this problem, the counter-factual event times are recensored by the minimum <span class="math inline">\(U_i\)</span> that could have been observed for each individual across their possible treatment changes.</p>
<p>Let <span class="math inline">\(C_i\)</span> be the potential censoring time for an individual <span class="math inline">\(i\)</span>. An individual is then recensored at the minimum possible censoring time: <span class="math display">\[
D_i^*(\psi) = min(C_i, C_i\exp(\psi)). 
\]</span> If <span class="math inline">\(D_i^*(\psi) &lt; U_i\)</span>, then <span class="math inline">\(U_i\)</span> is replaced by <span class="math inline">\(D_i^*\)</span> and the censoring indicator is replaced by 0. For treatment arms where switching does not occur, there can be no informative censoring and so recensoring is not applied.</p>
</div>
</div>
<div id="sensitivity-analysis" class="section level2">
<h2>Sensitivity analysis</h2>
<p>As previously mentioned, the RPSFTM has two assumptions:</p>
<ol style="list-style-type: decimal">
<li>The only difference between randomised groups is the treatment received.</li>
<li>The treatment effect is the same for all individuals regardless of when treatment is received.</li>
</ol>
<p>Whilst the first assumption is plausible in a randomised controlled trial, the latter may be unlikely to hold if, for example, control group patients can only switch at disease progression then the treatment benefit may be different in these individuals compared to those randomised to the experimental treatment. The <code>rpsftm</code> function allows for investigation of deviations from the common treatment effect assumption by featuring a treatment effect modifier variable which means the treatment effect can be varied across individuals. This is achieved by multiplying <span class="math inline">\(\psi\)</span> by some factor <span class="math inline">\(k_i\)</span>: <span class="math display">\[
U_i = T_i^{off} + T_i^{on}\exp(k_i\psi).
\]</span> For example, we can investigate what would happen to the estimate of <span class="math inline">\(\psi\)</span> if the treatment effect in switchers was half of that in the experimental group by setting <span class="math inline">\(k_i = 1\)</span> for patients in the experimental group and <span class="math inline">\(k_i = 0.5\)</span> for patients in the control group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
weight &lt;-<span class="st"> </span><span class="kw">with</span>(immdef, <span class="kw">ifelse</span>(imm<span class="op">==</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>))
<span class="kw">rpsftm</span>( <span class="kw">Surv</span>( progyrs, prog) <span class="op">~</span><span class="st"> </span><span class="kw">rand</span>( imm, rx), <span class="dt">data =</span> immdef, <span class="dt">censor_time =</span> censyrs,
        <span class="dt">treat_modifier =</span> weight
        )
<span class="co">#&gt;   arm   rx.Min. rx.1st Qu. rx.Median   rx.Mean rx.3rd Qu.   rx.Max.</span>
<span class="co">#&gt; 1   0 0.0000000  0.0000000 0.0000000 0.1574062  0.2547779 0.9770941</span>
<span class="co">#&gt; 2   1 1.0000000  1.0000000 1.0000000 1.0000000  1.0000000 1.0000000</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; rpsftm(formula = Surv(progyrs, prog) ~ rand(imm, rx), data = immdef, </span>
<span class="co">#&gt;     censor_time = censyrs, treat_modifier = weight)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;          N Observed Expected (O-E)^2/E (O-E)^2/V</span>
<span class="co">#&gt; .arm=0 500      157      157  5.75e-07  1.22e-06</span>
<span class="co">#&gt; .arm=1 500      143      143  6.31e-07  1.22e-06</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Chisq= 0  on 1 degrees of freedom, p= 1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; psi: -0.1704745</span>
<span class="co">#&gt; exp(psi): 0.8432646</span></code></pre></div>
<p>Recensoring is undertaken in a similar way by recensoring at the minimum possible censoring time: <span class="math display">\[
D_i^*(\psi) = min(C_i, C_i\exp(k_i\psi)).
\]</span> Again, if <span class="math inline">\(D_i^*(\psi) &lt; U_i\)</span>, then <span class="math inline">\(U_i\)</span> is replaced by <span class="math inline">\(D_i^*\)</span> and the censoring indicator is replaced by 0.</p>
</div>
<div id="limitations" class="section level2">
<h2>Limitations</h2>
<p>There are a few cases where we may encounter problems with root finding:</p>
<ol style="list-style-type: decimal">
<li>The interval (<code>low_psi</code>, <code>hi_psi</code>) may not be wide enough to find one or both of the confidence limits. This can be easily be rectified by extending the range.</li>
<li>No confidence limits may exist (i.e. they tail off to <span class="math inline">\(\pm \infty\)</span>). In this case they should be reported as <span class="math inline">\(\pm \infty\)</span>.</li>
<li>There may be multiple solutions to <span class="math inline">\(Z(\psi)=0\)</span> within the interval (<code>low_psi</code>, <code>hi_psi</code>). <code>uniroot</code> will return one value even if this is the case.</li>
</ol>
<p>For all of the above a graph of <span class="math inline">\(Z(\psi)\)</span> against <span class="math inline">\(\psi\)</span> would highlight the issue. Another possibility is for the <code>coxph</code> function to fail to converge. This occurs when the maximum likelihood estimate of a coefficient is infinity, e.g. if one of the treatment groups has no events. The <code>coxph</code> documentation states that the Wald statistic should be ignored in this case and therefore the <code>rpsftm</code> output should be taken with caution.</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Concorde Coordinating Committee. (1994). Concorde: MRC/ANRS randomised double-blind controlled trial of immediate and deferred zidovudine in symptom-free HIV infection. <em>Lancet</em> 343: 871-881.</p>
<p>Robins, J.M. and Tsiatis, A.A. (1991). Correcting for non-compliance in randomized trials using rank preserving structural failure time models. <em>Communications in Statistics Theory and Methods</em> 20:2609-2631.</p>
<p>White, I.R., Babiker, A.G., Walker, S. and Darbyshire, J.H. (1999). Randomisation-based methods for correcting for treatment changes: examples from the Concorde trial. <em>Statistics in Medicine</em> 18: 2617-2634.</p>
<p>White, I.R., Walker, S., Babiker, A.G. and Darbyshire, J.H. (1997). Impact of treatment changes on the interpretation of the Concorde trial. <em>AIDS</em> 11: 999-1006.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
